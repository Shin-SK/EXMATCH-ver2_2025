{% extends 'base.html' %}
{% load static %}

{% block active_terms_member %}active{% endblock %}

{% block title %}会員情報登録 | GPS-Live-Match{% endblock %}


{% block contents %}

<div class="container member form">
    <div class="w-100">
<!-- エラーメッセージ表示 -->
<!--            {{form.errors}}-->
        <div class="mainTitle">会員情報登録</div>
        <p>初回のみ、「性別」、「郵便番号」を登録してください。後から変更できます。</p>

        <p id="div0"></p>

        <div class="form__wrap">

            <form action="{% url 'live:member_create' %}" method="post">

                {% csrf_token %}

                <div class="area">

                    <div class="hidden">
                        <input type="hidden" name="group" size="40" value={{ g_name }}>
                    </div>

                    <div class="hidden">
                        <!--                <label for="formGroup1" style="font-size:13px;">お名前：</label>-->
                        <input type="hidden" class="form-control form-control-sm" id="formGroup1" placeholder="山田太郎" name="clientname" size="40" value={{ clientname }}>
                    </div>

                    <div class="hidden">
                        <!--                <label for="formGroup2" style="font-size:13px;">生年月日：（例：1990-01-10）</label>-->
                        <input type="hidden" class="form-control form-control-sm" id="formGroup2" placeholder="1990-01-10" name="birthday" size="25" value={{ birthday }}>
                    </div>
                    <div class="box">
                        <label class="title">性別</label>
                        <div class="radio">
                            <div class="radio__wrap">
                                <input type="radio" name="gender" id="exampleRadios1" value="True" checked>
                                <label class="radio__wrap--label" for="exampleRadios1">
                                    男性
                                </label>
                            </div>
                            <div class="radio__wrap">
                                <input type="radio" name="gender" id="exampleRadios2" value="False">
                                <label class="radio__wrap--label" for="exampleRadios2">
                                    女性
                                </label>
                            </div>
                    </div>
<!--                        <div class="form-check">-->
<!--                            <input class="form-check-input" type="radio" name="serviceclient_column_i" id="exampleRadios3" value=30>-->
<!--                            <label class="form-check-label" for="exampleRadios2" style="font-size:13px;">-->
<!--                                その他-->
<!--                            </label>-->
<!--                        </div>-->
                    </div>


                    <div class="box zip">
                        <label for="id_zip_code" class="title">郵便番号</label>

                        <input type="text" maxlength="7" id="id_zip_code" aria-describedby="emailHelp" placeholder="" name="postalcode">

<!--                                    <button id="search-button" class="btn btn-primary ml-2 mt-3 mb-3" type="button">住所取得</button>-->
<span id="emailHelp" style="color:red;font-size:12px;">※ 郵便番号を入力して「住所取得」をクリックしてください。</span>
                    </div>
                    
                    <!--                <div class="form-group">-->
                    <!--                <label for="formGroup3" style="font-size:13px;">郵便番号：（例：1810002）</label>-->
                    <!--                <input type="text" class="form-control form-control-sm" id="formGroup3" aria-describedby="emailHelp" placeholder="1810002" name="postalcode" onKeyUp="AjaxZip3.zip2addr(this,'','address1','address2');">-->
                    <!--                <small id="emailHelp" class="form-text text-muted" style="color:red;font-size:12px;">※ 正確な郵便番号を入力してください。</small>-->
                    <!--                </div>-->

                    <div class="hidden">
<!--                                        <label for="id_address1" style="font-size:15px;">都道府県：</label>-->
                        <input type="hidden" class="form-control form-control-sm" id="id_address1" placeholder="" name="address1" size="25" readonly>
                    </div>
                                <p id="ad1"></p>

                    <div class="hidden">
<!--                                        <label for="id_address2" style="font-size:15px;">市区町村：</label>-->
                        <input type="hidden" class="form-control form-control-sm" id="id_address2" placeholder="" name="address2" size="25" readonly>
                    </div>
                                <p id="ad2"></p>


                    <div class="hidden">
                        <!--                <label for="formGroup6" style="font-size:13px;">番地：（例：9-5-7）</label>-->
                        <input type="hidden" class="form-control form-control-sm" id="id_address3" placeholder="" name="address3" size="25" readonly>
                    </div>

                    <div class="hidden">
                        <!--                <label for="formGroup7" style="font-size:13px;">マンション名等：（例：ミタカハイツC101）</label>-->
                        <input type="hidden" class="form-control form-control-sm" id="formGroup7" placeholder="ミタカハイツC101" name="address4" size="25">
                    </div>

                    <div class="hidden">
                        <!--                <label for="exampleInputEmail1" style="font-size:13px;">Email：</label>-->
                        <!--                <input name="email1" type="email" class="form-control form-control-sm" id="exampleInputEmail1" aria-describedby="emailHelp1" size="100" value={{ user.email }} readonly>-->
                        <input name="email1" type="hidden" class="form-control form-control-sm" id="exampleInputEmail1" aria-describedby="emailHelp1" size="100" value={{ user.email }} readonly>
                        <!--                <small id="emailHelp1" class="form-text text-muted">※ 会員登録時のメールアドレスです。</small>-->
                    </div>

                    <div class="hidden">
                        <!--                <label for="exampleInputEmail2" style="font-size:13px;">Email：（例：email@example.jp）</label>-->
                        <!--                <input name="email2" type="email" class="form-control form-control-sm" id="exampleInputEmail2" aria-describedby="emailHelp2" placeholder="email@example.jp">-->
                        <input name="email2" type="hidden" class="form-control form-control-sm" id="exampleInputEmail2" aria-describedby="emailHelp2" placeholder="email@example.jp">
                        <!--                <small id="emailHelp2" class="form-text text-muted">※ 追加のメールアドレスがあれば登録してください。</small>-->
                    </div>

                    <div class="hidden">
                        <!--                <label for="formGroup8" style="font-size:13px;">携帯電話：（例：09012341234）</label>-->
                        <input type="hidden" class="form-control form-control-sm" id="formGroup8" placeholder="09065874598" name="phone" size="15" value={{ phone }}>
                    </div>

                    <button id="search-button" type="button">住所取得</button>
<!--                                <button id="search" class="btn btn-primary ml-2 mt-3 mb-3" type="submit">登録</button>-->
<!--                                <input class="btn btn-danger ml-2 mt-3 mb-3" type="reset" value="リセット">-->


                </div>
                    <p id="conf">住所がよろしければ「登録」してください。</p>
                    <button id="search" class="btn btn-primary ml-2 mt-3 mb-3" type="submit">登録</button>

            </form>
        </div>
<!--        <input class="btn btn-danger ml-2 mt-3 mb-3" type="reset" value="リセット">-->

        <a class="link-plane" href="{% url 'live:index' %}">ホーム</a>
    </div>
</div>


<script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>

<script>
        //「登録」ボタン、「conf」の非表示
        const search = document.getElementById( "search" );
        search.style.display = "none";  // Form画面の非表示
        const conf = document.getElementById( "conf" );
        conf.style.display = "none";  // Form画面の非表示
</script>

<script type="text/javascript">
    $(document).on('click', '#search-button', function(event){

        const google_key = '{{ google_key }}';  // '' が必要

        var ad1= document.getElementById("ad1");
        var ad2= document.getElementById("ad2");

        const conf = document.getElementById( "conf" );
        const search = document.getElementById( "search" );
        conf.style.display = "none";  // Form画面の非表示
        search.style.display = "none";  // Form画面の非表示

    address = $('#id_zip_code').val(),
    al = address.length

    if (address.length < 7) {
<!--        alert('正しい郵便番号7桁を入力してください');-->
            var doc0= document.getElementById("div0");
            doc0.style.color = "red";
            doc0.innerHTML= "正しい郵便番号7桁を入力してください";
            ad1.innerHTML= "";
            ad2.innerHTML= "";
            conf.style.display = "none";  // Form画面の非表示
            search.style.display = "none";  // Form画面の非表示

        return false;
        }else{
            var doc0= document.getElementById("div0");
            doc0.innerHTML= "";

            }


        $.ajax({
            url: 'https://maps.googleapis.com/maps/api/geocode/json',
            type: 'GET',
            dataType: 'json',
            data: {
                key: google_key,
                address: $('#id_zip_code').val(),
                language: 'ja'
            }
        }).done(function(data) {
            if (data.status == "OK") {
                var components = data.results[0].address_components;
                if (components.length < 5) {
<!--                    alert('正しい郵便番号を入力してください');-->
                    var doc0= document.getElementById("div0");
                    doc0.innerHTML= "正しい郵便番号を入力してください";
                    ad1.innerHTML= "";
                    ad2.innerHTML= "";
                    conf.style.display = "none";  // Form画面の非表示
                    search.style.display = "none";  // Form画面の非表示

                    return false;
                }
                if (components.length == 5) {
<!--                alert('正しい郵便番号です');-->
                conf.style.display = "flex";  // boxB画面の表示
                search.style.display = "flex";  // boxB画面の表示
                    $('#id_address1').val(components[3].long_name);
                    ad1.innerHTML= components[3].long_name;
                    $('#id_address2').val(components[2].long_name + ' ' + components[1].long_name);
                    // $('#id_address3').val(components[2].long_name);
                    $('#id_address3').val('0-0-0');
                    console.log('0-0-0' + components[2].long_name + ' ' + components[1].long_name);
                    // 半角スペースで市区町村住所を区切る
                    ad2.innerHTML= components[2].long_name + ' ' + components[1].long_name;
                } else if (components.length == 6) {
                conf.style.display = "flex";  // boxB画面の表示
                search.style.display = "flex";  // boxB画面の表示
                    $('#id_address1').val(components[4].long_name);
                    ad1.innerHTML= components[4].long_name;
                    $('#id_address2').val(components[3].long_name + ' ' + components[2].long_name);
                    // $('#id_address3').val(components[3].long_name);
                    $('#id_address3').val('0-0-0');
                    console.log('0-0-0');
                    ad2.innerHTML= components[3].long_name + ' ' + components[2].long_name;
                }
            }else{
<!--            alert('郵便番号が間違っています！住所が見つかりません。');-->
            var doc0= document.getElementById("div0");
            doc0.style.color = "red";
            doc0.innerHTML= "郵便番号が間違っています！住所が見つかりません。";
            ad1.innerHTML= "";
            ad2.innerHTML= "";
            conf.style.display = "none";  // Form画面の非表示
            search.style.display = "none";  // Form画面の非表示

            return false;
            }


        });
    });


</script>

{% endblock %}
